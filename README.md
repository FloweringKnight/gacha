# gacha - 随机字母生成与抽卡命令行工具

一个跨平台的 C 语言命令行工具，通过随机生成字母并匹配字典单词，实现趣味性的文本生成和抽卡功能。

## 功能特性

### Chaos 模式 (v1.0)
- ✅ 随机生成字母（范围 a-zA-Z）
- ✅ 实时匹配字典单词（严格完整匹配）
- ✅ 匹配成功时换行并加粗显示
- ✅ 支持自定义配置文件（Markdown 格式）
- ✅ 历史匹配次数统计

### Gacha 模式 (v2.0 - 新增)
- ✅ 从 gachalist 随机抽取菜名
- ✅ 600 道菜名，按难度分为 5 个等级（N、R、SR、SSR、UR）
- ✅ 抽卡次数受历史总匹配次数限制
- ✅ 支持批量抽取（1-1000 次）
- ✅ 显示抽取统计信息
- ✅ 余额不足时确认提示

### 通用特性
- ✅ 跨平台支持（Windows、Linux、macOS）
- ✅ 配置文件自动生成和管理
- ✅ 友好的命令行界面
- ✅ 版本信息显示（-v/--version）

## 系统要求

- C99 兼容的编译器（GCC、Clang、MSVC）
- CMake 3.10 或更高版本

## 编译安装

### 使用 CMake 编译

```bash
# 创建构建目录
mkdir build
cd build

# 配置
cmake ..

# 编译
cmake --build .

# 运行
./gacha -h
```

### 手动编译

```bash
# Linux/macOS
gcc -std=c99 -o gacha src/*.c -I src

# Windows (MinGW)
gcc -std=c99 -o gacha.exe src/*.c -I src

# Windows (MSVC)
cl /std:c99 /Fe:gacha.exe src/*.c /I src
```

## 使用方法

### 命令概览

```bash
gacha -c              # 启动 chaos 模式
gacha -g [数字]       # 启动 gacha 模式（默认抽取 1 次）
gacha -h              显示帮助信息
gacha -v              显示版本信息
gacha --version       显示版本信息
```

### Chaos 模式

随机生成字母并匹配字典单词，每次匹配成功增加 1 次历史总匹配次数。

```bash
gacha -c
```

**停止方式：**
- 按 `Ctrl+C` 手动停止
- 当任一字典单词匹配次数 ≥ 3 时自动停止

**示例输出：**
```
开始随机生成 (每秒 2 个字母)
字典包含 2 个单词，按 Ctrl+C 停止

xyzHello
World
abHello
World
匹配总数: 4
历史总匹配次数: 4
```

### Gacha 模式

从 gachalist 中随机抽取菜名，每次抽卡消耗 1 次历史总匹配次数。

#### 单次抽取

```bash
gacha -g
```

**示例输出：**
```
当前抽卡余额：10 次
【N】番茄炒蛋
剩余抽卡余额：9 次

本次抽取 1 次：
【N】1 次
【R】0 次
【SR】0 次
【SSR】0 次
【UR】0 次
```

#### 批量抽取

```bash
gacha -g 10
```

**示例输出：**
```
当前抽卡余额：10 次
【R】宫保鸡丁
【N】青椒肉丝
【SSR】东坡肉
【N】白米饭
【SR】水煮鱼
【R】红烧肉
【N】番茄炒蛋
【UR】开水白菜
【N】炒青菜
【R】麻婆豆腐
剩余抽卡余额：0 次

本次抽取 10 次：
【N】4 次
【R】4 次
【SR】1 次
【SSR】1 次
【UR】1 次
```

#### 余额不足提示

当历史总匹配次数为 0 时：
```bash
gacha -g
```
**输出：**
```
剩余抽卡次数为 0
```

当请求抽取次数大于余额时：
```bash
gacha -g 10
```
**输出：**
```
当前余额仅能进行 【5】 次抽卡，是否继续？（y/n）
```
- 输入 `y` 或 `Y`：使用剩余次数进行抽卡
- 输入其他内容：直接退出

### 游戏流程

1. **获取抽卡次数**：运行 `gacha -c` 命令，通过匹配单词积累历史总匹配次数
2. **进行抽卡**：运行 `gacha -g [数字]` 消耗抽卡次数抽取菜名
3. **查看统计**：每次抽卡显示各等级的抽取次数

## 配置文件

### 配置文件位置

- Windows: `%APPDATA%/gacha/gacha.conf`
- Linux/macOS: `~/.config/gacha/gacha.conf`

### 配置文件格式

配置文件使用 Markdown 格式：

```markdown
# Gacha Configuration

## 字母生成速度
- 每秒生成字母数：2

## 字典列表
- Hello
- World

## 历史统计
- 历史总匹配次数：10
```

### 配置项说明

| 配置项     | 说明          | 默认值          | 范围   |
|---------|-------------|--------------|------|
| 每秒生成字母数 | 随机字母生成速度    | 2            | 1-60 |
| 字典列表    | 要匹配的单词列表    | Hello, World | 任意数量 |
| 历史总匹配次数 | 所有运行的累计匹配次数 | 0            | ≥0   |

### gachalist 文件

**文件位置**：与 gacha.conf 存放在同一目录

**文件格式**：纯文本文件，每行一个菜名，格式为 `【等级】菜名`

**等级分布**：
- **N 级**（300 道）：最简单，家常菜
  - 示例：番茄炒蛋、青椒肉丝、炒青菜
- **R 级**（150 道）：简单，普通菜
  - 示例：宫保鸡丁、红烧肉、麻婆豆腐
- **SR 级**（90 道）：中等，需要技巧
  - 示例：东坡肉、佛跳墙、北京烤鸭
- **SSR 级**（45 道）：困难，工艺复杂
  - 示例：开水白菜、文思豆腐、孔雀开屏鱼
- **UR 级**（15 道）：极难，大师级
  - 示例：开水白菜（国宴版）、佛跳墙（正宗）、龙井虾仁（极品）

**示例内容**：
```
【N】番茄炒蛋
【N】青椒肉丝
【R】宫保鸡丁
【SSR】东坡肉
【UR】开水白菜
```

**自定义菜名**：
用户可以手动编辑 gachalist 文件，添加、删除或修改菜名，程序会自动重新加载。

## 工作原理

### Chaos 模式

1. 程序以指定速度随机生成字母（a-zA-Z）
2. 生成的字母连续输出到终端
3. 使用滑动窗口实时搜索字典单词
4. 当生成的字母序列与字典单词完全匹配时：
   - 在单词后插入换行
   - 以加粗样式显示匹配的单词
   - 计数器 +1
5. 当任一单词匹配次数 ≥ 3 时自动停止
6. 显示本次匹配总数和历史总匹配次数

### Gacha 模式

1. 读取配置文件获取历史总匹配次数（抽卡余额）
2. 加载 gachalist 文件
3. 根据用户请求的抽取次数，验证余额是否充足
4. 余额不足时提示用户确认
5. 从 gachalist 中等权随机抽取菜名
6. 更新历史总匹配次数并保存到配置文件
7. 显示抽取结果和统计信息

## 项目结构

```
gacha/
├── CMakeLists.txt                  # CMake 构建配置
├── README.md                       # 项目说明
├── .rules/                        # 项目规则
│   └── project-background.md
├── .requirement/                  # 需求文档
│   ├── functional-requirements.md  # 第一版需求
│   ├── technical-design.md         # 第一版技术设计
│   ├── functional-requirements-v2.md # 第二版需求
│   └── technical-design-v2.md     # 第二版技术设计
├── src/                           # 源代码
│   ├── main.c                     # 主程序
│   ├── config.h/c                 # 配置管理
│   ├── random.h/c                 # 随机生成
│   ├── matcher.h/c                # 匹配引擎
│   ├── output.h/c                 # 输出控制
│   ├── gacha.h/c                 # 抽卡模块（v2.0 新增）
│   └── list.h/c                  # 菜名列表管理（v2.0 新增）
└── tests/                        # 测试代码
    └── test_basic.sh              # 基础测试
```

## 版本历史

### v2.0 (当前版本)
- 新增 Gacha 模式
- 新增 gachalist 文件，包含 600 道菜名
- 菜名按难度分为 5 个等级（N、R、SR、SSR、UR）
- 抽卡次数与历史总匹配次数关联
- 支持批量抽取和统计显示
- 余额不足时确认提示
- 新增版本显示功能（-v/--version 参数）

### v1.0
- Chaos 模式：随机生成字母并匹配字典单词
- 支持自定义配置文件
- 历史匹配次数统计
- 跨平台支持

## 许可证

本项目仅供学习和研究使用。

## 贡献

欢迎提交 Issue 和 Pull Request！
